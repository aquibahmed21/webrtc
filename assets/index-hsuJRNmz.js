(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const y=document.getElementById("roomName"),m=document.getElementById("startButton"),g=document.getElementById("joinButton"),w=document.getElementById("localVideo"),h=document.getElementById("remoteVideo"),u=new window.Scaledrone("EoIG3R1I4JdyS4L1");let n,t=null,c=!1,l=null;async function f(){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),w.srcObject=l}catch(e){console.error("Error accessing media devices:",e)}}async function E(){t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),t.ontrack=e=>{e.streams&&e.streams[0]&&(h.srcObject=e.streams[0])},t.onicecandidate=e=>{e.candidate&&(n==null||n.publish({type:"candidate",candidate:e.candidate}))},t.onnegotiationneeded=async()=>{if(!c&&t){c=!0;try{const e=await t.createOffer();await t.setLocalDescription(e),n==null||n.publish({type:"offer",sdp:e.sdp})}catch(e){console.error("Error creating offer:",e)}finally{c=!1}}},l&&l.getTracks().forEach(e=>{t==null||t.addTrack(e,l)})}async function p(e){n=u.subscribe(e),n.on("open",async o=>{if(o)return console.error(o);console.log("Successfully joined room"),await E()}),n.on("members",async o=>{if(o.length===2&&t){console.log("Starting negotiation as initiator"),c=!0;try{const i=await t.createOffer();await t.setLocalDescription(i),n.publish({type:"offer",sdp:i.sdp})}catch(i){console.error("Error creating offer:",i)}finally{c=!1}}}),n.on("member_joined",async o=>{console.log("Member joined",o)}),n.on("member_left",o=>{console.log("Member left",o)}),n.on("data",async(o,s)=>{if((s==null?void 0:s.id)!==u.clientId)if(o.type==="offer"&&t){console.log("Received offer"),c=!0;try{await t.setRemoteDescription(new RTCSessionDescription(o));const i=await t.createAnswer();await t.setLocalDescription(i),n.publish({type:"answer",sdp:i.sdp})}catch(i){console.error("Error handling offer:",i)}finally{c=!1}}else o.type==="answer"&&t?(console.log("Received answer"),await t.setRemoteDescription(new RTCSessionDescription(o))):o.type==="candidate"&&t&&await t.addIceCandidate(new RTCIceCandidate(o.candidate))})}m.addEventListener("click",async()=>{const e=y.value||"helloWorld";await f(),await p(e)});g.addEventListener("click",async()=>{const e=y.value||"helloWorld";await f(),await p(e)});f();
