(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();document.querySelector("#app").innerHTML=`
  <div class="copy">Send your URL to a friend to start a video call</div>
  <video id="localVideo" autoplay muted></video>
  <video id="remoteVideo" autoplay></video>
`;location.hash||(location.hash=Math.floor(Math.random()*16777215).toString(16));const m=location.hash.substring(1),d=new ScaleDrone("EoIG3R1I4JdyS4L1"),u="observable-"+m,h={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};let s,t;function g(){}function c(r){console.error(r)}d.on("open",r=>{if(r)return console.error(r);s=d.subscribe(u),s.on("open",e=>{e&&c(e)}),s.on("members",e=>{console.log("MEMBERS",e);const n=e.length===2;y(n)})});function p(r){d.publish({room:u,message:r})}function y(r){t=new RTCPeerConnection(h),t.onicecandidate=e=>{e.candidate&&p({candidate:e.candidate})},r&&(t.onnegotiationneeded=()=>{t.createOffer().then(f).catch(c)}),t.ontrack=e=>{const n=e.streams[0];(!remoteVideo.srcObject||remoteVideo.srcObject.id!==n.id)&&(remoteVideo.srcObject=n)},navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=>{localVideo.srcObject=e,e.getTracks().forEach(n=>t.addTrack(n,e))},c),s.on("data",(e,n)=>{n.id!==d.clientId&&(e.sdp?t.setRemoteDescription(new RTCSessionDescription(e.sdp),()=>{t.remoteDescription.type==="offer"&&t.createAnswer().then(f).catch(c)},c):e.candidate&&t.addIceCandidate(new RTCIceCandidate(e.candidate),g,c))})}function f(r){t.setLocalDescription(r,()=>p({sdp:t.localDescription}),c)}
