(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&t(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();function D(a,e,r){const t=new window.Scaledrone("EoIG3R1I4JdyS4L1"),n=t.subscribe(a);return t.on("open",e),n.on("message",r),{drone:t,room:n}}const f={};let w,p=null;function E(a,e){w=a;const r="observable-e7b2d4",{drone:t,room:n}=D(r,o,m);function o(d){if(d)return console.error(d);console.log("Connected to Scaledrone")}function m(d){const{data:l,member:h}=d,i=h.id;if(i!==t.clientId)switch(l.type){case"offer":g(i,!1,e),f[i].setRemoteDescription(new RTCSessionDescription(l.offer)),f[i].createAnswer().then(s=>{f[i].setLocalDescription(s),t.publish({room:r,message:{type:"answer",answer:s,to:i}})});break;case"answer":l.to===t.clientId&&f[i]&&f[i].setRemoteDescription(new RTCSessionDescription(l.answer));break;case"candidate":l.to===t.clientId&&f[i]&&f[i].addIceCandidate(new RTCIceCandidate(l.candidate));break}}n.on("members",d=>{d.forEach(l=>{l.id!==t.clientId&&g(l.id,!0,e)})});function g(d,l,h){const i=p=new RTCPeerConnection;i.onicecandidate=s=>{s.candidate&&t.publish({room:r,message:{type:"candidate",candidate:s.candidate,to:d}})},i.ontrack=s=>{h(s.streams[0],d)},w.getTracks().forEach(s=>i.addTrack(s,w)),l&&i.createOffer().then(s=>{i.setLocalDescription(s),t.publish({room:r,message:{type:"offer",offer:s,to:d}})}),f[d]=i}}let v=0,b=0,u=null,T=0;const S=document.querySelector("#quality"),C=document.querySelector("#framerate");S.addEventListener("change",async a=>{if(!u)return;const[e,r]=a.target.value.split("x").map(Number);await k(e,r,T)&&await V()});C.addEventListener("change",async a=>{if(!u)return;const e=Number(a.target.value);await k(v,b,e)&&await V()});async function L(a,e,r){try{const t={video:{width:{ideal:a},height:{ideal:e},frameRate:{ideal:r}},audio:!0};return await navigator.mediaDevices.getUserMedia(t)}catch(t){return console.error("Failed to get media stream:",t),null}}async function I(){try{return!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices?(console.log("enumerateDevices() not supported."),[]):(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput")}catch(a){return console.error("Error getting camera list:",a),[]}}async function k(a,e,r){b=e,v=a,T=r;const t=await L(a,e,r);if(!t)return!1;const n=t.getVideoTracks()[0];if(u){const o=u.getVideoTracks()[0];o&&o.stop(),u.removeTrack(o),u.addTrack(n)}else u=t;return!0}async function M(){const[a,e]=S.value.split("x").map(Number),r=Number(C.value);return await k(a,e,r),u}function y(a,e,r=!1){const t=document.createElement("video");t.srcObject=a,t.id=e,t.autoplay=!0,t.playsInline=!0,r?document.getElementsByClassName("Channel")[0].appendChild(t):document.getElementsByClassName("Channel")[0].prepend(t)}async function V(){const a=p,e=a.getSenders().find(r=>r.track&&r.track.kind==="video");if(e){const r=e.track;try{r.stop();const n=u.getVideoTracks()[0];await e.replaceTrack(n);const o=await a.createOffer();await a.setLocalDescription(o)}catch(t){console.error("Error updating local video stream:",t),e&&r&&e.replaceTrack&&await e.replaceTrack(r)}}else console.log("No video sender found.")}let c=null;document.querySelector("#controls").addEventListener("click",async a=>{const e=a.target;switch(a.target.id){case"start":await O();break;case"muteAudio":e.textContent=c.getAudioTracks()[0].enabled?"Unmute Audio":"Mute Audio",c.getAudioTracks()[0].enabled=!c.getAudioTracks()[0].enabled;break;case"muteVideo":e.textContent=c.getVideoTracks()[0].enabled?"Unmute Video":"Mute Video",c.getVideoTracks()[0].enabled=!c.getVideoTracks()[0].enabled;break;case"switchCamera":const n=(c.getVideoTracks()[0].getSettings().facingMode||"user")==="user"?"environment":"user",o={video:{width:localwidth,height:localheight,frameRate:localframeRate,facingMode:{ideal:n}},audio:!0},m=await navigator.mediaDevices.getUserMedia(o);c.getVideoTracks()[0].stop(),c.removeTrack(c.getVideoTracks()[0]),c.addTrack(m.getVideoTracks()[0]),c=m,y(c,"localVideo",!0);break;case"hangup":c.getTracks().forEach(g=>g.stop()),c=null,document.querySelector(".Channel").innerHTML="",p.getSenders().forEach(g=>{g.track&&g.track.stop()}),p.close();break}});async function O(){c=await M(),y(c,"localVideo",!0),E(c,(a,e)=>{document.getElementById(e)||y(a,e)})}I().then(a=>{a.length<=1&&(document.querySelector("#switchCamera").style.display="none")});
